<app-form-section
  icon="location_on"
  [title]="'cooperative.sections.location' | transloco"
  [subtitle]="'cooperative.location.mapInstructions' | transloco"
>
  <div class="location-section">
    <div class="coordinate-inputs">
      <mat-form-field appearance="outline">
        <mat-label>{{ "cooperative.fields.latitude" | transloco }}</mat-label>
        <input
          matInput
          type="number"
          [formControl]="latitudeControl"
          step="0.000001"
          [readonly]="editMode"
        />
        <mat-error
          *ngIf="
            latitudeControl.hasError('min') || latitudeControl.hasError('max')
          "
        >
          {{ "cooperative.errors.invalidLatitude" | transloco }}
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>{{ "cooperative.fields.longitude" | transloco }}</mat-label>
        <input
          matInput
          type="number"
          [formControl]="longitudeControl"
          step="0.000001"
          [readonly]="editMode"
        />
        <mat-error
          *ngIf="
            longitudeControl.hasError('min') || longitudeControl.hasError('max')
          "
        >
          {{ "cooperative.errors.invalidLongitude" | transloco }}
        </mat-error>
      </mat-form-field>

      <div class="location-actions">
        <!-- Use current location button -->
        <app-base-button
          buttonType="raised"
          color="primary"
          icon="my_location"
          [loading]="locationLoading"
          (clicked)="onUseCurrentLocation()"
          translationKey="cooperative.location.useCurrentLocation"
          class="location-button"
          *ngIf="!editMode"
        >
        </app-base-button>

        <!-- Location modification buttons -->
        <div class="location-modification-buttons" *ngIf="hasLocation">
          <app-base-button
            buttonType="stroked"
            color="primary"
            icon="{{ editMode ? 'save' : 'edit_location' }}"
            (clicked)="toggleEditMode()"
          >
            {{
              (editMode ? "common.actions.done" : "common.actions.edit")
                | transloco
            }}
          </app-base-button>

          <app-base-button
            buttonType="stroked"
            color="warn"
            icon="delete"
            (clicked)="clearLocation()"
            *ngIf="!editMode"
          >
            {{ "common.actions.clear" | transloco }}
          </app-base-button>
        </div>

        <!-- Error message display -->
        <div class="location-error" *ngIf="locationError">
          <mat-icon>error</mat-icon>
          <span>{{ locationError }}</span>
        </div>
      </div>
    </div>

    <div class="map-container">
      <!-- OpenLayers Map -->
      <aol-map class="map-component" (onClick)="onMapClick($event)" #map>
        <aol-view [zoom]="mapZoom">
          <aol-coordinate
            [x]="mapCenter[0]"
            [y]="mapCenter[1]"
          ></aol-coordinate>
        </aol-view>

        <!-- Base Map Layer -->
        <aol-layer-tile>
          <aol-source-osm></aol-source-osm>
        </aol-layer-tile>

        <!-- Vector Layer for Marker -->
        <aol-layer-vector>
          <aol-source-vector #vectorSource></aol-source-vector>
          <aol-style>
            <aol-style-icon
              src="assets/images/map-marker.png"
              [anchor]="[0.5, 1]"
              [anchorXUnits]="'fraction'"
              [anchorYUnits]="'fraction'"
              [scale]="1"
            ></aol-style-icon>
          </aol-style>
        </aol-layer-vector>

        <!-- Only add the draw interaction when in edit mode -->
        <aol-interaction-draw
          *ngIf="editMode"
          type="Point"
          [source]="vectorSourceInstance!"
          (drawEnd)="onDrawEnd($event)"
        ></aol-interaction-draw>

        <!-- Map Controls -->
        <aol-control-defaults></aol-control-defaults>
        <aol-control-zoom></aol-control-zoom>
        <aol-control-scaleline></aol-control-scaleline>
      </aol-map>

      <!-- Map interaction helper overlays
      <div class="map-status-overlay" *ngIf="editMode">
        <div class="map-status-message">
          <mat-icon>touch_app</mat-icon>
          <span>{{
            "cooperative.location.clickToSetLocation" | transloco
          }}</span>
        </div>
      </div>

      <div class="map-instructions" *ngIf="!hasLocation && !editMode">
        <div>
          <mat-icon>touch_app</mat-icon>
          <p>{{ "cooperative.location.mapClickInstructions" | transloco }}</p>
        </div>
      </div>
      -->
    </div>
  </div>
</app-form-section>

<div class="step-actions">
  <app-base-button
    variant="secondary"
    size="large"
    icon="arrow_back"
    (click)="onPrevious()"
  >
    {{ "common.actions.previous" | transloco }}
  </app-base-button>

  <app-base-button
    variant="primary"
    size="large"
    icon="arrow_forward"
    (click)="onNext()"
  >
    {{ "common.actions.next" | transloco }}
  </app-base-button>
</div>
